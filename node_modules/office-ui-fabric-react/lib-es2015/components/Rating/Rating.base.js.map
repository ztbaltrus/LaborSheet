{"version":3,"file":"Rating.base.js","sourceRoot":"../src/","sources":["components/Rating/Rating.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {\r\n  BaseComponent,\r\n  classNamesFunction,\r\n  css,\r\n  customizable,\r\n  format,\r\n  getId\r\n} from '../../Utilities';\r\nimport {\r\n  IClassNames\r\n} from '@uifabric/utilities/lib/IClassNames';\r\nimport { Icon } from '../../Icon';\r\nimport { FocusZone, FocusZoneDirection } from '../../FocusZone';\r\nimport { IRatingProps, RatingSize, IRatingStyleProps, IRatingStyles } from './Rating.types';\r\n\r\nconst getClassNames = classNamesFunction<IRatingStyleProps, IRatingStyles>();\r\n\r\ninterface IRatingStarProps extends React.AllHTMLAttributes<HTMLElement> {\r\n  fillPercentage: number;\r\n  disabled: boolean;\r\n  readOnly: boolean;\r\n  classNames: IClassNames<IRatingStyles>;\r\n}\r\n\r\nexport interface IRatingState {\r\n  rating: number | null | undefined;\r\n}\r\n\r\nconst RatingStar = (props: IRatingStarProps, ) => (\r\n  <div\r\n    className={ props.classNames.ratingStar }\r\n    key={ props.id }\r\n  >\r\n    <Icon\r\n      className={ props.classNames.ratingStarBack }\r\n      iconName='FavoriteStarFill'\r\n    />\r\n    {\r\n      !props.disabled &&\r\n      <Icon\r\n        className={ props.classNames.ratingStarFront }\r\n        iconName='FavoriteStarFill'\r\n        style={ { width: props.fillPercentage + '%' } }\r\n      />\r\n    }\r\n  </div >\r\n);\r\n\r\n@customizable('Rating', ['theme', 'getStyles'])\r\nexport class RatingBase extends BaseComponent<IRatingProps, IRatingState> {\r\n  public static defaultProps: IRatingProps = {\r\n    min: 1,\r\n    max: 5\r\n  };\r\n  private _id: string;\r\n  private _min: number;\r\n  private _labelId: string;\r\n  private _classNames: { [key in keyof IRatingStyles]: string };\r\n\r\n  constructor(props: IRatingProps) {\r\n    super(props);\r\n\r\n    this._id = getId('Rating');\r\n    this._min = this.props.allowZeroStars ? 0 : 1;\r\n    if (this.props.min !== undefined && this.props.min !== 1) {\r\n      this._min = this.props.min;\r\n    }\r\n    this._labelId = getId('RatingLabel');\r\n\r\n    this.state = {\r\n      rating: this._getInitialValue(props)\r\n    };\r\n  }\r\n\r\n  public componentWillReceiveProps(nextProps: IRatingProps): void {\r\n    if (typeof nextProps.rating !== 'undefined' && nextProps.rating !== this.state.rating) {\r\n      this.setState({\r\n        rating: this._getClampedRating(nextProps.rating)\r\n      } as IRatingState);\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const id = this._id;\r\n    const stars = [];\r\n    const starIds = [];\r\n    const {\r\n      disabled,\r\n      getAriaLabel,\r\n      getStyles,\r\n      max,\r\n      rating,\r\n      readOnly,\r\n      size,\r\n      theme\r\n    } = this.props;\r\n\r\n    this._classNames = getClassNames(getStyles!, {\r\n      disabled,\r\n      readOnly,\r\n      theme: theme!\r\n    });\r\n\r\n    for (let i = this._min as number; i <= (max as number); i++) {\r\n      if (i !== 0) {\r\n        const ratingStarProps: IRatingStarProps = {\r\n          fillPercentage: this._getFillingPercentage(i),\r\n          disabled: disabled ? true : false,\r\n          readOnly: readOnly ? true : false,\r\n          classNames: this._classNames\r\n        };\r\n\r\n        starIds.push(this._getStarId(i - 1));\r\n\r\n        stars.push(\r\n          <button\r\n            className={ css(this._classNames.ratingButton, {\r\n              [this._classNames.ratingStarIsLarge]: size === RatingSize.Large,\r\n              [this._classNames.ratingStarIsSmall]: size !== RatingSize.Large\r\n            }) }\r\n            id={ starIds[i - 1] }\r\n            key={ i }\r\n            { ...((i === Math.ceil(this.state.rating as number)) ? { 'data-is-current': true } : {}) }\r\n            onFocus={ this._onFocus.bind(this, i) }\r\n            onClick={ this._onFocus.bind(this, i) } // For Safari & Firefox on OSX\r\n            disabled={ disabled || readOnly ? true : false }\r\n            role='presentation'\r\n            type='button'\r\n          >\r\n            { this._getLabel(i) }\r\n            <RatingStar key={ i + 'rating' }  { ...ratingStarProps } />\r\n          </button>\r\n        );\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={ css('ms-Rating-star', this._classNames.root, {\r\n          [this._classNames.rootIsLarge]: size === RatingSize.Large,\r\n          [this._classNames.rootIsSmall]: size !== RatingSize.Large\r\n        }) }\r\n        aria-label={ getAriaLabel ? getAriaLabel(this.state.rating ? this.state.rating : 0, this.props.max as number) : '' }\r\n        id={ id }\r\n      >\r\n        <FocusZone\r\n          direction={ FocusZoneDirection.horizontal }\r\n          tabIndex={ readOnly ? 0 : -1 }\r\n          className={ css(this._classNames.ratingFocusZone, {\r\n            [this._classNames.rootIsLarge]: size === RatingSize.Large,\r\n            [this._classNames.rootIsSmall]: size !== RatingSize.Large\r\n          }) }\r\n          data-is-focusable={ readOnly ? true : false }\r\n          defaultActiveElement={ rating ? starIds[rating - 1] && '#' + starIds[rating - 1] : undefined }\r\n        >\r\n          { stars }\r\n        </FocusZone>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private _getStarId(index: number): string {\r\n    return this._id + '-star-' + index;\r\n  }\r\n\r\n  private _onFocus(value: number, ev: React.FocusEvent<HTMLElement>): void {\r\n    if (this.state.rating !== value) {\r\n      this.setState({\r\n        rating: value\r\n      } as IRatingState);\r\n\r\n      const { onChanged } = this.props;\r\n      if (onChanged) {\r\n        onChanged(value);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _getLabel(rating: number): JSX.Element {\r\n    const text = this.props.ariaLabelFormat || '';\r\n\r\n    return (\r\n      <span\r\n        id={ `${this._labelId}-${rating}` }\r\n        className={ this._classNames.labelText }\r\n      >\r\n        { format(text, rating, this.props.max) }\r\n      </span >\r\n    );\r\n  }\r\n\r\n  private _getInitialValue(props: IRatingProps): number | undefined {\r\n    if (typeof props.rating === 'undefined') {\r\n      return this._min;\r\n    }\r\n\r\n    if (props.rating === null) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._getClampedRating(props.rating);\r\n  }\r\n\r\n  private _getClampedRating(rating: number): number {\r\n    return Math.min(Math.max(rating, this._min as number), this.props.max as number);\r\n  }\r\n\r\n  private _getFillingPercentage(starPosition: number): number {\r\n    const ceilValue = Math.ceil((this.state.rating as number));\r\n    let fillPercentage = 100;\r\n\r\n    if (starPosition === this.state.rating) {\r\n      fillPercentage = 100;\r\n    } else if (starPosition === ceilValue) {\r\n      fillPercentage = 100 * (this.state.rating as number % 1);\r\n    } else if (starPosition > ceilValue) {\r\n      fillPercentage = 0;\r\n    }\r\n    return fillPercentage;\r\n  }\r\n}\r\n"]}