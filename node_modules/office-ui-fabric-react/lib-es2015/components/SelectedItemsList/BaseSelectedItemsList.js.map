{"version":3,"file":"BaseSelectedItemsList.js","sourceRoot":"../src/","sources":["components/SelectedItemsList/BaseSelectedItemsList.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {\r\n  BaseComponent,\r\n  KeyCodes\r\n} from '../../Utilities';\r\nimport { Selection } from '../../Selection';\r\n\r\nimport { IBaseSelectedItemsList, IBaseSelectedItemsListProps, ISelectedItemProps } from './BaseSelectedItemsList.types';\r\n\r\nexport interface IBaseSelectedItemsListState {\r\n  // tslint:disable-next-line:no-any\r\n  items?: any;\r\n  suggestedDisplayValue?: string;\r\n  moreSuggestionsAvailable?: boolean;\r\n  isSearching?: boolean;\r\n  isMostRecentlyUsedVisible?: boolean;\r\n  suggestionsVisible?: boolean;\r\n  suggestionsLoading?: boolean;\r\n  isResultsFooterVisible?: boolean;\r\n}\r\n\r\nexport class BaseSelectedItemsList<T, P extends IBaseSelectedItemsListProps<T>>\r\n  extends BaseComponent<P, IBaseSelectedItemsListState> implements IBaseSelectedItemsList<T> {\r\n\r\n  protected root: HTMLElement;\r\n  protected selection: Selection;\r\n\r\n  constructor(basePickerProps: P) {\r\n    super(basePickerProps);\r\n\r\n    const items: T[] = basePickerProps.selectedItems || basePickerProps.defaultSelectedItems || [];\r\n    this.state = {\r\n      items: items,\r\n    };\r\n\r\n    // Create a new selection if one is not specified\r\n    this.selection = this.props.selection\r\n      ? this.props.selection as Selection\r\n      : new Selection({ onSelectionChanged: this.onSelectionChanged });\r\n  }\r\n\r\n  public get items(): T[] {\r\n    return this.state.items;\r\n  }\r\n\r\n  public addItems = (items: T[]): void => {\r\n    // tslint:disable-next-line:no-any\r\n    const processedItems: T[] | PromiseLike<T[]> = this.props.onItemSelected ? (this.props.onItemSelected as any)(items) : items;\r\n\r\n    const processedItemObjects: T[] = processedItems as T[];\r\n    const processedItemPromiseLikes: PromiseLike<T[]> = processedItems as PromiseLike<T[]>;\r\n\r\n    if (processedItemPromiseLikes && processedItemPromiseLikes.then) {\r\n      processedItemPromiseLikes.then((resolvedProcessedItems: T[]) => {\r\n        const newItems: T[] = this.state.items.concat(resolvedProcessedItems);\r\n        this.updateItems(newItems);\r\n      });\r\n    } else {\r\n      const newItems: T[] = this.state.items.concat(processedItemObjects);\r\n      this.updateItems(newItems);\r\n    }\r\n    this.setState({ suggestedDisplayValue: '' });\r\n  }\r\n\r\n  public removeItemAt = (index: number): void => {\r\n    const { items } = this.state;\r\n    // tslint:disable-next-line:no-any\r\n    if (index > -1) {\r\n      if (this.props.onItemDeleted) {\r\n        (this.props.onItemDeleted as (item: T) => void)(items[index]);\r\n      }\r\n\r\n      const newItems = items.slice(0, index).concat(items.slice(index + 1));\r\n      this.updateItems(newItems);\r\n    }\r\n  }\r\n\r\n  public removeItem = (item: ISelectedItemProps<T>): void => {\r\n    const { items } = this.state;\r\n    const index: number = items.indexOf(item);\r\n\r\n    this.removeItemAt(index);\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public removeItems = (itemsToRemove: any[]): void => {\r\n    const { items } = this.state;\r\n    // tslint:disable-next-line:no-any\r\n    const newItems: T[] = items.filter((item: any) => itemsToRemove.indexOf(item) === -1);\r\n    const firstItemToRemove = itemsToRemove[0];\r\n    const index: number = items.indexOf(firstItemToRemove);\r\n\r\n    if (this.props.onItemDeleted) {\r\n      itemsToRemove.forEach((item: T) => {\r\n        (this.props.onItemDeleted as (item: T) => void)(item);\r\n      });\r\n    }\r\n\r\n    this.updateItems(newItems, index);\r\n  }\r\n\r\n  /**\r\n   * Controls what happens whenever there is an action that impacts the selected items.\r\n   * If selectedItems is provided as a property then this will act as a controlled component and it will not update it's own state.\r\n  */\r\n  public updateItems(items: T[], focusIndex?: number): void {\r\n    if (this.props.selectedItems) {\r\n      // If the component is a controlled component then the controlling component will need\r\n      this.onChange(items);\r\n    } else {\r\n      this.setState({ items: items }, () => {\r\n        this._onSelectedItemsUpdated(items, focusIndex);\r\n      });\r\n    }\r\n  }\r\n\r\n  public onCopy = (ev: React.ClipboardEvent<HTMLElement>): void => {\r\n    if (this.props.onCopyItems && this.selection.getSelectedCount() > 0) {\r\n      const selectedItems: T[] = this.selection.getSelection() as T[];\r\n      this.copyItems(selectedItems);\r\n    }\r\n  }\r\n\r\n  public unselectAll(): void {\r\n    this.selection.setAllSelected(false);\r\n  }\r\n\r\n  public componentWillUpdate(newProps: P, newState: IBaseSelectedItemsListState): void {\r\n    if (newState.items && newState.items !== this.state.items) {\r\n      this.selection.setItems(newState.items);\r\n    }\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this.selection.setItems(this.state.items);\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: P): void {\r\n    const newItems = newProps.selectedItems;\r\n\r\n    if (newItems) {\r\n      this.setState({ items: newProps.selectedItems });\r\n    }\r\n\r\n    if (newProps.selection) {\r\n      this.selection = newProps.selection;\r\n    }\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public render(): any {\r\n    return this.renderItems();\r\n  }\r\n\r\n  protected renderItems = (): JSX.Element[] => {\r\n    const { removeButtonAriaLabel } = this.props;\r\n    const onRenderItem = this.props.onRenderItem as (props: ISelectedItemProps<T>) => JSX.Element;\r\n\r\n    const { items } = this.state;\r\n    // tslint:disable-next-line:no-any\r\n    return items.map((item: any, index: number) => onRenderItem({\r\n      item,\r\n      index,\r\n      key: item.key ? item.key : index,\r\n      selected: this.selection.isIndexSelected(index),\r\n      onRemoveItem: () => this.removeItem(item),\r\n      onItemChange: this.onItemChange,\r\n      removeButtonAriaLabel: removeButtonAriaLabel,\r\n      onCopyItem: (itemToCopy: T) => this.copyItems([itemToCopy]),\r\n    }));\r\n  }\r\n\r\n  protected onSelectionChanged = (): void => {\r\n    this.forceUpdate();\r\n  }\r\n\r\n  protected onChange(items?: T[]): void {\r\n    if (this.props.onChange) {\r\n      (this.props.onChange as (items?: T[]) => void)(items);\r\n    }\r\n  }\r\n\r\n  protected onKeyDown = (ev: React.KeyboardEvent<HTMLElement>): void => {\r\n    switch (ev.which) {\r\n      case KeyCodes.backspace:\r\n        ev.stopPropagation();\r\n        this.onBackspace(ev);\r\n        break;\r\n\r\n      case KeyCodes.del:\r\n        this.onBackspace(ev);\r\n    }\r\n  }\r\n\r\n  protected onItemChange = (changedItem: T, index: number): void => {\r\n    const { items } = this.state;\r\n\r\n    if (index >= 0) {\r\n      const newItems: T[] = items;\r\n      newItems[index] = changedItem;\r\n\r\n      this.updateItems(newItems);\r\n    }\r\n  }\r\n\r\n  // This is protected because we may expect the backspace key to work differently in a different kind of picker.\r\n  // This lets the subclass override it and provide it's own onBackspace. For an example see the BasePickerListBelow\r\n  protected onBackspace(ev: React.KeyboardEvent<HTMLElement>): void {\r\n    if (this.state.items.length) {\r\n      if (this.selection.getSelectedCount() > 0) {\r\n        this.removeItems(this.selection.getSelection());\r\n      } else {\r\n        this.removeItem(this.state.items[this.state.items.length - 1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected copyItems(items: T[]): void {\r\n    if (this.props.onCopyItems) {\r\n      // tslint:disable-next-line:no-any\r\n      const copyText = (this.props.onCopyItems as any)(items);\r\n\r\n      const copyInput = document.createElement('input') as HTMLInputElement;\r\n      document.body.appendChild(copyInput);\r\n\r\n      try {\r\n        // Try to copy the text directly to the clipboard\r\n        copyInput.value = copyText;\r\n        copyInput.select();\r\n        if (!document.execCommand('copy')) {\r\n          // The command failed. Fallback to the method below.\r\n          throw new Error();\r\n        }\r\n      } catch (err) {\r\n        // no op\r\n      } finally {\r\n        document.body.removeChild(copyInput);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _isFocusZoneInnerKeystroke(ev: React.KeyboardEvent<HTMLElement>): boolean {\r\n    return false;\r\n  }\r\n\r\n  private _onSelectedItemsUpdated(items?: T[], focusIndex?: number): void {\r\n    this.onChange(items);\r\n  }\r\n}"]}