{"version":3,"file":"DocumentCardTitle.js","sourceRoot":"../src/","sources":["components/DocumentCard/DocumentCardTitle.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\n\r\nimport {\r\n  BaseComponent,\r\n  css,\r\n  createRef\r\n} from '../../Utilities';\r\nimport { IDocumentCardTitleProps } from './DocumentCard.types';\r\nimport * as stylesImport from './DocumentCard.scss';\r\n\r\nconst styles: any = stylesImport;\r\n\r\nexport interface IDocumentCardTitleState {\r\n  truncatedTitleFirstPiece?: string;\r\n  truncatedTitleSecondPiece?: string;\r\n}\r\n\r\nconst TRUNCATION_SEPARATOR = '&hellip;';\r\nconst TRUNCATION_MINIMUM_LENGTH = 40; // This is the length we know can fit into the min width of DocumentCard.\r\nconst TRUNCATION_MAXIMUM_LENGTH = 90 - TRUNCATION_SEPARATOR.length;\r\n\r\n// This is the length we know can fit into the min width 2 lines of DocumentCard.\r\nconst TRUNCATION_MINI_LENGTH_SECONDARY = 80;\r\nconst TRUNCATION_MAX_LENGTH_SECONDARY = 130 - TRUNCATION_SEPARATOR.length;\r\nconst TRUNCATION_FIRST_PIECE_LONGER_BY = 10;\r\nconst TRUNCATION_VERTICAL_OVERFLOW_THRESHOLD = 5;\r\n\r\nexport class DocumentCardTitle extends BaseComponent<IDocumentCardTitleProps, IDocumentCardTitleState> {\r\n  private _titleElement = createRef<HTMLDivElement>();\r\n  private _scrollTimerId: number;\r\n  private _truncatedTitleAtWidth: number;\r\n  private _isTruncated: boolean;\r\n\r\n  constructor(props: IDocumentCardTitleProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      truncatedTitleFirstPiece: '',\r\n      truncatedTitleSecondPiece: ''\r\n    };\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    const { title, shouldTruncate, showAsSecondaryTitle } = this.props;\r\n    const miniLength = showAsSecondaryTitle ? TRUNCATION_MINI_LENGTH_SECONDARY : TRUNCATION_MINIMUM_LENGTH;\r\n    if (shouldTruncate && title && title.length > miniLength) {\r\n      if (this._doesTitleOverflow()) {\r\n        this._startTruncation(this.props);\r\n      }\r\n      this._events.on(window, 'resize', this._updateTruncation);\r\n    }\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: IDocumentCardTitleProps): void {\r\n    this._events.off(window, 'resize');\r\n    this._isTruncated = false;\r\n\r\n    const miniLength = newProps.showAsSecondaryTitle ? TRUNCATION_MINI_LENGTH_SECONDARY : TRUNCATION_MINIMUM_LENGTH;\r\n    if (newProps.shouldTruncate && newProps.title && newProps.title.length > miniLength) {\r\n      this._startTruncation(newProps);\r\n      this._events.on(window, 'resize', this._updateTruncation);\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(): void {\r\n    // If we're truncating, make sure the title fits\r\n    if (this.props.shouldTruncate) {\r\n      this._shrinkTitle();\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const { title, shouldTruncate, showAsSecondaryTitle } = this.props;\r\n    const { truncatedTitleFirstPiece, truncatedTitleSecondPiece } = this.state;\r\n\r\n    let documentCardTitle;\r\n    if (shouldTruncate && this._isTruncated) {\r\n      documentCardTitle = (\r\n        <div className={ css('ms-DocumentCardTitle', showAsSecondaryTitle ? styles.secondaryTitle : styles.title) } ref={ this._titleElement } title={ title }>\r\n          { truncatedTitleFirstPiece }&hellip;{ truncatedTitleSecondPiece }\r\n        </div>\r\n      );\r\n    } else {\r\n      documentCardTitle = (\r\n        <div className={ css('ms-DocumentCardTitle', showAsSecondaryTitle ? styles.secondaryTitle : styles.title) } ref={ this._titleElement } title={ title }>\r\n          { title }\r\n        </div>\r\n      );\r\n    }\r\n    return documentCardTitle;\r\n  }\r\n\r\n  private _startTruncation = (props: IDocumentCardTitleProps): void => {\r\n    const originalTitle = props.title;\r\n    this._isTruncated = false;\r\n    const miniLength = props.showAsSecondaryTitle ? TRUNCATION_MINI_LENGTH_SECONDARY : TRUNCATION_MINIMUM_LENGTH;\r\n    const maxLength = props.showAsSecondaryTitle ? TRUNCATION_MAX_LENGTH_SECONDARY : TRUNCATION_MAXIMUM_LENGTH;\r\n\r\n    // If the title is really short, there's no need to truncate it\r\n    if (originalTitle && originalTitle.length >= miniLength) {\r\n\r\n      // Break the text into two pieces for assembly later\r\n      if (originalTitle.length > maxLength) {\r\n        // The text is really long, so we can take a chunk out of the middle so the two pieces combine for the maximum length\r\n        this._isTruncated = true;\r\n        this.setState({\r\n          truncatedTitleFirstPiece: originalTitle.slice(0, maxLength / 2 + TRUNCATION_FIRST_PIECE_LONGER_BY),\r\n          truncatedTitleSecondPiece: originalTitle.slice(originalTitle.length - (maxLength / 2 - TRUNCATION_FIRST_PIECE_LONGER_BY))\r\n        });\r\n      } else {\r\n        // The text is not so long, so we'll just break it into two pieces\r\n        this.setState({\r\n          truncatedTitleFirstPiece: originalTitle.slice(0, Math.ceil(originalTitle.length / 2) + TRUNCATION_FIRST_PIECE_LONGER_BY),\r\n          truncatedTitleSecondPiece: originalTitle.slice(originalTitle.length - Math.floor(originalTitle.length / 2) + TRUNCATION_FIRST_PIECE_LONGER_BY)\r\n        });\r\n      }\r\n    }\r\n\r\n    // Save the width we just started truncation at, so that later we will only update truncation if necessary\r\n    if (this._titleElement.current) {\r\n      this._truncatedTitleAtWidth = this._titleElement.current.clientWidth;\r\n    }\r\n\r\n  }\r\n\r\n  private _shrinkTitle(): void {\r\n    if (this._doesTitleOverflow()) {\r\n      const { truncatedTitleFirstPiece, truncatedTitleSecondPiece } = this.state;\r\n      this._isTruncated = true;\r\n\r\n      if (!truncatedTitleFirstPiece && !truncatedTitleSecondPiece) {\r\n        this._startTruncation(this.props);\r\n      }\r\n\r\n      this.setState({\r\n        truncatedTitleFirstPiece: truncatedTitleFirstPiece!.slice(0, truncatedTitleFirstPiece!.length - 1),\r\n        truncatedTitleSecondPiece: truncatedTitleSecondPiece!.slice(1)\r\n      });\r\n    }\r\n  }\r\n\r\n  private _doesTitleOverflow(): boolean {\r\n    const titleElement = this._titleElement.current;\r\n\r\n    if (!titleElement) {\r\n      return false;\r\n    }\r\n\r\n    return titleElement.scrollHeight > titleElement.clientHeight + TRUNCATION_VERTICAL_OVERFLOW_THRESHOLD || titleElement.scrollWidth > titleElement.clientWidth;\r\n  }\r\n\r\n  private _updateTruncation(): void {\r\n    // Only update truncation if the title's size has changed since the last time we truncated\r\n    if (this._titleElement.current && (this._titleElement.current.clientWidth !== this._truncatedTitleAtWidth)) {\r\n      // Throttle truncation so that it doesn't happen during a window resize\r\n      clearTimeout(this._scrollTimerId);\r\n      this._scrollTimerId = this._async.setTimeout(this._startTruncation.bind(this, this.props), 250);\r\n    }\r\n  }\r\n\r\n}\r\n"]}