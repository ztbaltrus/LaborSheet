{"version":3,"file":"Coachmark.js","sourceRoot":"../src/","sources":["components/Coachmark/Coachmark.tsx"],"names":[],"mappings":";;;IAsBA,IAAM,aAAa,GAAG,8BAAkB,EAA0C,CAAC;IAEtE,QAAA,wBAAwB,GAAG,kBAAkB,CAAC;IAgF3D;QAA+B,qCAA+C;QA2B5E,mBAAY,KAAsB;YAAlC,YACE,kBAAM,KAAK,CAAC,SAab;YA7BD;;;eAGG;YACK,6BAAuB,GAAG,qBAAS,EAAkB,CAAC;YACtD,kCAA4B,GAAG,qBAAS,EAAkB,CAAC;YAC3D,yBAAmB,GAAG,qBAAS,EAAkB,CAAC;YAClD,2BAAqB,GAAG,qBAAS,EAAyB,CAAC;YAiN3D,gBAAU,GAAG,UAAC,CAAM;gBAC1B,sEAAsE;gBACtE,IACE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,KAAK,eAAe,CAAC;oBACpC,CAAC,CAAC,CAAC,KAAK,mBAAmB;wBACzB,KAAI,CAAC,4BAA4B,CAAC,OAAO;wBACzC,KAAI,CAAC,4BAA4B,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAC/D;oBACA,KAAI,CAAC,eAAe,EAAE,CAAC;iBACxB;YACH,CAAC,CAAA;YAEO,qBAAe,GAAG;gBACxB,IAAI,KAAI,CAAC,KAAK,CAAC,WAAW,EAAE;oBAC1B,KAAI,CAAC,cAAc,EAAE,CAAC;iBACvB;YACH,CAAC,CAAA;YAEO,mBAAa,GAAG,UAAC,YAA6B;gBACpD,KAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC;oBACjC,KAAI,CAAC,QAAQ,CAAC;wBACZ,eAAe,EAAE,YAAY,CAAC,aAAa;wBAC3C,cAAc,EAAE,YAAY,CAAC,UAAU;qBACxC,CAAC,CAAC;gBACL,CAAC,CAAC,CAAC,CAAC;YACN,CAAC,CAAA;YAkCO,sBAAgB,GAAG;gBACzB,IAAI,QAAQ,CAAC;gBACb,IAAI,OAAO,CAAC;gBACZ,IAAI,SAAS,CAAC;gBACd,IAAI,UAAU,CAAC;gBACf,IAAI,gBAAgB,CAAC;gBACrB,IAAI,gBAAgB,CAAC;gBAEb,IAAA,6CAAe,CAAgB;gBACvC,IAAM,kBAAkB,GAAG,KAAK,CAAC,CAAE,kEAAkE;gBAErG,QAAQ,KAAI,CAAC,cAAc,EAAE;oBAC3B,iCAAiC;oBACjC,KAAK,2BAAa,CAAC,GAAG,CAAC;oBACvB,KAAK,2BAAa,CAAC,MAAM;wBACvB,2EAA2E;wBAC3E,IAAI,CAAC,eAAe,EAAE;4BACpB,QAAQ,GAAG,gBAAc,iBAAU,GAAG,CAAC,QAAK,CAAC;4BAC7C,gBAAgB,GAAG,QAAQ,CAAC;yBAC7B;6BAAM;4BACL,wCAAwC;4BACxC,IAAI,eAAe,KAAK,2BAAa,CAAC,IAAI,EAAE;gCAC1C,QAAQ,GAAM,kCAAe,GAAG,CAAC,GAAG,iBAAU,GAAG,CAAC,OAAI,CAAC;gCACvD,gBAAgB,GAAG,MAAM,CAAC;6BAC3B;iCAAM;gCACL,yCAAyC;gCACzC,SAAS,GAAM,kCAAe,GAAG,CAAC,GAAG,iBAAU,GAAG,CAAC,OAAI,CAAC;gCACxD,gBAAgB,GAAG,OAAO,CAAC;6BAC5B;yBACF;wBAED,IAAI,KAAI,CAAC,cAAc,KAAK,2BAAa,CAAC,GAAG,EAAE;4BAC7C,OAAO,GAAG,kBAAkB,CAAC;4BAC7B,gBAAgB,GAAG,KAAK,CAAC;yBAC1B;6BAAM;4BACL,UAAU,GAAG,kBAAkB,CAAC;4BAChC,gBAAgB,GAAG,QAAQ,CAAC;yBAC7B;wBACD,MAAM;oBACR,oCAAoC;oBACpC,KAAK,2BAAa,CAAC,IAAI,CAAC;oBACxB,KAAK,2BAAa,CAAC,KAAK;wBACtB,2EAA2E;wBAC3E,IAAI,CAAC,eAAe,EAAE;4BACpB,OAAO,GAAG,gBAAc,iBAAU,GAAG,CAAC,QAAK,CAAC;4BAC5C,gBAAgB,GAAG,QAAQ,CAAC;yBAC7B;6BAAM;4BACL,uCAAuC;4BACvC,IAAI,eAAe,KAAK,2BAAa,CAAC,GAAG,EAAE;gCACzC,OAAO,GAAM,kCAAe,GAAG,CAAC,GAAG,iBAAU,GAAG,CAAC,OAAI,CAAC;gCACtD,gBAAgB,GAAG,KAAK,CAAC;6BAC1B;iCAAM;gCACL,0CAA0C;gCAC1C,UAAU,GAAM,kCAAe,GAAG,CAAC,GAAG,iBAAU,GAAG,CAAC,OAAI,CAAC;gCACzD,gBAAgB,GAAG,QAAQ,CAAC;6BAC7B;yBACF;wBAED,IAAI,KAAI,CAAC,cAAc,KAAK,2BAAa,CAAC,IAAI,EAAE;4BAC9C,QAAQ,GAAG,kBAAkB,CAAC;4BAC9B,gBAAgB,GAAG,MAAM,CAAC;yBAC3B;6BAAM;4BACL,SAAS,GAAG,kBAAkB,CAAC;4BAC/B,gBAAgB,GAAG,OAAO,CAAC;yBAC5B;wBACD,MAAM;iBACT;gBAED,KAAI,CAAC,QAAQ,CAAC;oBACZ,QAAQ,EAAE,QAAQ;oBAClB,SAAS,EAAE,SAAS;oBACpB,UAAU,EAAE,UAAU;oBACtB,OAAO,EAAE,OAAO;oBAChB,eAAe,EAAK,gBAAgB,SAAI,gBAAkB;iBAC3D,CAAC,CAAC;YACL,CAAC,CAAA;YAEO,oBAAc,GAAG;gBACvB,KAAI,CAAC,QAAQ,CAAC;oBACZ,WAAW,EAAE,KAAK;iBACnB,CAAC,CAAC;gBAEH,IAAI,KAAI,CAAC,KAAK,CAAC,oBAAoB,EAAE;oBACnC,KAAI,CAAC,KAAK,CAAC,oBAAoB,EAAE,CAAC;iBACnC;gBAED,KAAI,CAAC,uBAAuB,CAAC,OAAO;oBAClC,KAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,gBAAgB,CACnD,eAAe,EACf;wBACE,sCAAsC;wBACtC,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;4BACrB,IAAI,KAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE;gCAChC,KAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;6BACtC;wBACH,CAAC,EAAE,GAAG,CAAC,CAAC;wBAER,IAAI,KAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE;4BACjC,KAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE,CAAC;yBACjC;oBACH,CAAC,CACF,CAAC;YACN,CAAC,CAAA;YAvWC,yBAAyB;YACzB,KAAI,CAAC,KAAK,GAAG;gBACX,WAAW,EAAE,KAAK,CAAC,WAAY;gBAC/B,iBAAiB,EAAE,IAAI;gBACvB,WAAW,EAAE,IAAI;gBACjB,mBAAmB,EAAE;oBACnB,KAAK,EAAE,CAAC;oBACR,MAAM,EAAE,CAAC;iBACV;gBACD,kBAAkB,EAAE,KAAK;aAC1B,CAAC;;QACJ,CAAC;QAED,sBAAY,qCAAc;iBAA1B;gBACU,IAAA,0CAAc,CAAgB;gBACtC,IAAI,cAAc,KAAK,SAAS,EAAE;oBAChC,OAAO,2BAAa,CAAC,MAAM,CAAC;iBAC7B;gBAED,OAAO,6BAAe,CAAC,cAAc,CAAC,CAAC;YACzC,CAAC;;;WAAA;QAEM,0BAAM,GAAb;YACQ,IAAA,eAUQ,EATZ,sBAAQ,EACR,kBAAM,EACN,gBAAK,EACL,wDAAyB,EACzB,oCAAe,EACf,4CAAmB,EACnB,kCAAc,EACd,0CAAkB,EAClB,gCAAa,CACA;YAET,IAAA,eAWQ,EAVZ,sBAAQ,EACR,oBAAO,EACP,wBAAS,EACT,0BAAU,EACV,4BAAW,EACX,wCAAiB,EACjB,4BAAW,EACX,4CAAmB,EACnB,oCAAe,EACf,wBAAS,CACI;YAEf,IAAM,UAAU,GAAG,aAAa,CAAC,4BAAS,EAAE;gBAC1C,WAAW,EAAE,WAAW;gBACxB,iBAAiB,EAAE,iBAAiB;gBACpC,WAAW,EAAE,WAAW;gBACxB,gBAAgB,EAAK,mBAAmB,CAAC,MAAM,OAAI;gBACnD,eAAe,EAAK,mBAAmB,CAAC,KAAK,OAAI;gBACjD,KAAK,EAAK,kCAAe,OAAI;gBAC7B,MAAM,EAAK,mCAAgB,OAAI;gBAC/B,KAAK,EAAE,KAAK;gBACZ,eAAe,EAAE,eAAe;aACjC,CAAC,CAAC;YAEH,IAAM,WAAW,GAAW,WAAW,CAAC,CAAC,CAAC,mCAAgB,CAAC,CAAC,CAAC,mBAAmB,CAAC,MAAM,CAAC;YAExF,OAAO,CACL,oBAAC,4BAAoB,qBACnB,MAAM,EAAG,MAAM,EACf,gBAAgB,EAAG,kBAAW,EAC9B,YAAY,EAAG,IAAI,CAAC,qBAAqB,EACzC,WAAW,EAAG,WAAW,EACzB,YAAY,EAAG,IAAI,CAAC,aAAa,EACjC,MAAM,EAAG,IAAI,CAAC,UAAU,EAAE,IACrB,yBAAyB;gBAE9B,6BAAK,SAAS,EAAG,UAAU,CAAC,IAAI;oBAC5B,aAAa,IAAI,CACjB,6BACE,SAAS,EAAG,UAAU,CAAC,aAAa,EACpC,IAAI,EAAC,OAAO,EACZ,GAAG,EAAG,IAAI,CAAC,mBAAmB,iBAChB,CAAC,WAAW,IAExB,SAAS,CACP,CACP;oBACD,6BAAK,SAAS,EAAG,UAAU,CAAC,aAAa,GAAK;oBAC9C,6BACE,SAAS,EAAG,UAAU,CAAC,2BAA2B,EAClD,GAAG,EAAG,IAAI,CAAC,4BAA4B;wBAEvC,6BAAK,SAAS,EAAG,UAAU,CAAC,mBAAmB;4BAC7C,6BAAK,SAAS,EAAG,UAAU,CAAC,oBAAoB;gCAE5C,IAAI,CAAC,qBAAqB,CAAC,OAAO,IAAI,oBAAC,WAAI,IACzC,IAAI,EAAG,QAAQ,EACf,GAAG,EAAG,OAAO,EACb,KAAK,EAAG,SAAS,EACjB,MAAM,EAAG,UAAU,EACnB,SAAS,EAAG,IAAI,CAAC,cAAc,EAC/B,KAAK,EAAG,KAAK,GACb;gCAEJ,oBAAC,6BAAa,IAAC,2BAA2B,EAAG,IAAI;oCAC/C,6BACE,SAAS,EAAG,UAAU,CAAC,UAAU,EACjC,QAAQ,EAAG,CAAC,CAAC,uBACO,IAAI,EACxB,IAAI,EAAC,QAAQ,qBACK,cAAc,sBACb,eAAe;wCAEhC,WAAW,IAAI;4CACf,cAAc,IAAI,CAChB,2BAAG,EAAE,EAAG,cAAc,EAAG,SAAS,EAAG,UAAU,CAAC,aAAa,IACzD,kBAAkB,CAClB,CACL;4CACD,eAAe,IAAI,CACjB,2BAAG,EAAE,EAAG,eAAe,EAAG,SAAS,EAAG,UAAU,CAAC,aAAa,IAC1D,mBAAmB,CACnB,CACL;yCACF;wCACD,6BACE,SAAS,EAAG,UAAU,CAAC,eAAe,EACtC,GAAG,EAAG,IAAI,CAAC,uBAAuB,iBACpB,WAAW,IAEvB,QAAQ,CACN,CACF,CACQ,CACZ,CACF,CACF,CACF,CACe,CACxB,CAAC;QACJ,CAAC;QAEM,6CAAyB,GAAhC,UAAiC,QAAyB;YACxD,IAAI,IAAI,CAAC,KAAK,CAAC,WAAW,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE;gBACnD,iCAAiC;gBACjC,IAAI,CAAC,cAAc,EAAE,CAAC;aACvB;QACH,CAAC;QAEM,yCAAqB,GAA5B,UAA6B,QAAyB,EAAE,QAAyB;YAC/E,OAAO,CAAC,0BAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,0BAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACxF,CAAC;QAEM,sCAAkB,GAAzB,UAA0B,SAA0B,EAAE,SAA0B;YAC9E,IAAI,SAAS,CAAC,eAAe,KAAK,IAAI,CAAC,KAAK,CAAC,eAAe,IAAI,SAAS,CAAC,cAAc,KAAK,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE;gBACtH,IAAI,CAAC,gBAAgB,EAAE,CAAC;aACzB;QACH,CAAC;QAEM,qCAAiB,GAAxB;YAAA,iBAqCC;YApCC,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAC/B;gBACE,IACE,KAAI,CAAC,uBAAuB,CAAC,OAAO;oBACpC,KAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,KAAK,GAAG,KAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,KAAK,KAAK,CAAC,EACjF;oBACA,KAAI,CAAC,QAAQ,CAAC;wBACZ,WAAW,EAAE,KAAK;wBAClB,mBAAmB,EAAE;4BACnB,KAAK,EAAE,KAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,WAAW;4BACvD,MAAM,EAAE,KAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,YAAY;yBAC1D;qBACF,CAAC,CAAC;oBACH,KAAI,CAAC,gBAAgB,EAAE,CAAC;oBACxB,KAAI,CAAC,WAAW,EAAE,CAAC;iBACpB;gBAED,KAAI,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,KAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;gBAE5D,iFAAiF;gBACjF,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;oBACrB,KAAI,CAAC,oBAAoB,CAAC,KAAI,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC;gBAC7D,CAAC,EAAE,KAAI,CAAC,KAAK,CAAC,oBAAqB,CAAC,CAAC;gBAErC,yEAAyE;gBACzE,IAAI,KAAI,CAAC,KAAK,CAAC,aAAa,EAAE;oBAC5B,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,IAAI,KAAI,CAAC,KAAK,CAAC,aAAa,IAAI,KAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE;4BAChE,KAAI,CAAC,QAAQ,CAAC;gCACZ,SAAS,EAAE,KAAI,CAAC,KAAK,CAAC,aAAa;6BACpC,CAAC,CAAC;yBACJ;oBACH,CAAC,EAAE,CAAC,CAAC,CAAC;iBACP;YACH,CAAC,CACF,CAAC;QACJ,CAAC;QAEM,wCAAoB,GAA3B;YACE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QAC/D,CAAC;QA6BO,8BAAU,GAAlB;YACQ,IAAA,eAA4D,EAA1D,sCAAgB,EAAE,wDAAyB,CAAgB;YACnE,IAAI,gBAAgB,EAAE;gBACpB,yGAAyG;gBACzG,gEAAgE;gBAChE,IAAI,yBAAyB,IAAI,CAC/B,yBAAyB,CAAC,eAAe,wBAAgC;oBACzE,yBAAyB,CAAC,eAAe,2BAAmC,CAC7E,EAAE;oBACD,OAAO;wBACL,IAAI,EAAE,CAAC;wBACP,GAAG,EAAE,CAAC,QAAQ;wBACd,MAAM,EAAE,QAAQ;wBAChB,KAAK,EAAE,MAAM,CAAC,UAAU;wBACxB,KAAK,EAAE,MAAM,CAAC,UAAU;wBACxB,MAAM,EAAE,QAAQ;qBACjB,CAAC;iBACH;qBAAM;oBACL,OAAO;wBACL,IAAI,EAAE,CAAC,QAAQ;wBACf,GAAG,EAAE,CAAC,QAAQ;wBACd,MAAM,EAAE,QAAQ;wBAChB,KAAK,EAAE,QAAQ;wBACf,KAAK,EAAE,QAAQ;wBACf,MAAM,EAAE,QAAQ;qBACjB,CAAC;iBACH;aACF;iBAAM;gBACL,OAAO,SAAS,CAAC;aAClB;QACH,CAAC;QA0GO,wCAAoB,GAA5B,UAA6B,oBAAgC;YAA7D,iBA+CC;YA/C4B,qCAAA,EAAA,wBAAgC;YAC3D;;;eAGG;YACH,IAAM,UAAU,GAAa,EAAE,CAAC;YAEhC,gEAAgE;YAChE,yBAAyB;YACzB,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;gBACrB,KAAI,CAAC,qBAAqB,EAAE,CAAC;gBAE7B,2CAA2C;gBAC3C,qCAAqC;gBACrC,+CAA+C;gBAC/C,mDAAmD;gBACnD,iBAAiB;gBACjB,KAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE;oBAChC,UAAU,CAAC,OAAO,CAAC,UAAC,KAAa;wBAC/B,aAAa,CAAC,KAAK,CAAC,CAAC;oBACvB,CAAC,CAAC,CAAC;oBAEH,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrC,KAAI,CAAC,qBAAqB,EAAE,CAAC;oBAC/B,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;gBACX,CAAC,CAAC,CAAC;YACL,CAAC,EAAE,EAAE,CAAC,CAAC;YAEP,oDAAoD;YACpD,+CAA+C;YAC/C,iCAAiC;YACjC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,WAAW,EAAE,UAAC,CAAa;gBACnD,IAAI,KAAI,CAAC,KAAK,CAAC,WAAW,EAAE;oBAC1B,IAAM,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC;oBACvB,IAAM,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC;oBACvB,KAAI,CAAC,qBAAqB,EAAE,CAAC;oBAC7B,IAAM,kBAAkB,GAAG,KAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM,EAAE,oBAAoB,CAAC,CAAC;oBAEvF,IAAI,kBAAkB,KAAK,KAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE;wBACxD,KAAI,CAAC,cAAc,EAAE,CAAC;qBACvB;iBACF;gBAED,IAAI,KAAI,CAAC,KAAK,CAAC,WAAW,EAAE;oBAC1B,KAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;iBAC3B;YACH,CAAC,CAAC,CAAC;QACL,CAAC;QAEO,yCAAqB,GAA7B;YACE,IAAI,IAAI,CAAC,4BAA4B,IAAI,IAAI,CAAC,4BAA4B,CAAC,OAAO,EAAE;gBAClF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,4BAA6B,CAAC,OAAQ,CAAC,qBAAqB,EAAE,CAAC;aAC/F;QACH,CAAC;QAEO,oCAAgB,GAAxB,UAAyB,MAAc,EAAE,MAAc,EAAE,oBAAgC;YAAhC,qCAAA,EAAA,wBAAgC;YACvF,OAAO,MAAM,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,GAAG,oBAAoB,CAAC;gBACnE,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,oBAAoB,CAAC;gBAChG,MAAM,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,GAAG,oBAAoB,CAAC;gBAC7D,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,GAAG,oBAAoB,CAAC,CAAC;QACrG,CAAC;QAlca,sBAAY,GAA6B;YACrD,WAAW,EAAE,IAAI;YACjB,oBAAoB,EAAE,EAAE;YACxB,oBAAoB,EAAE,IAAI;YAC1B,KAAK,EAAE,wBAAc,CAAC,YAAY;YAClC,gBAAgB,EAAE,IAAI;YACtB,yBAAyB,EAAE;gBACzB,eAAe,wBAAgC;aAChD;SACF,CAAC;QA0bJ,gBAAC;KAAA,AApcD,CAA+B,yBAAa,GAoc3C;IApcY,8BAAS","sourcesContent":["// Utilities\r\nimport * as React from 'react';\r\nimport { BaseComponent, classNamesFunction, createRef, IRectangle, KeyCodes, shallowCompare } from '../../Utilities';\r\nimport { DefaultPalette } from '../../Styling';\r\nimport { IPositionedData, RectangleEdge, getOppositeEdge } from '../../utilities/positioning';\r\n\r\n// Component Dependencies\r\nimport { PositioningContainer, IPositioningContainer } from './PositioningContainer/index';\r\nimport { Beak, BEAK_HEIGHT, BEAK_WIDTH } from './Beak/Beak';\r\nimport { DirectionalHint } from '../../common/DirectionalHint';\r\n\r\n// Coachmark\r\nimport { ICoachmarkTypes } from './Coachmark.types';\r\nimport {\r\n  COACHMARK_HEIGHT,\r\n  COACHMARK_WIDTH,\r\n  getStyles,\r\n  ICoachmarkStyles,\r\n  ICoachmarkStyleProps\r\n} from './Coachmark.styles';\r\nimport { FocusTrapZone } from '../FocusTrapZone';\r\n\r\nconst getClassNames = classNamesFunction<ICoachmarkStyleProps, ICoachmarkStyles>();\r\n\r\nexport const COACHMARK_ATTRIBUTE_NAME = 'data-coachmarkid';\r\n\r\n/**\r\n * An interface for the cached dimensions of entity inner host.\r\n */\r\nexport interface IEntityRect {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ICoachmarkState {\r\n  /**\r\n   * Is the Coachmark currently collapsed into\r\n   * a tear drop shape\r\n   */\r\n  isCollapsed: boolean;\r\n\r\n  /**\r\n   * Enables/Disables the beacon that radiates\r\n   * from the center of the coachmark.\r\n   */\r\n  isBeaconAnimating: boolean;\r\n\r\n  /**\r\n   * Is the teaching bubble currently retreiving the\r\n   * original dimensions of the hosted entity.\r\n   */\r\n  isMeasuring: boolean;\r\n\r\n  /**\r\n   * Cached width and height of _entityInnerHostElement\r\n   */\r\n  entityInnerHostRect: IEntityRect;\r\n\r\n  /**\r\n   * Is the mouse in proximity of the default target element\r\n   */\r\n  isMouseInProximity: boolean;\r\n\r\n  /**\r\n   * The left position of the beak\r\n   */\r\n  beakLeft?: string;\r\n\r\n  /**\r\n   * The right position of the beak\r\n   */\r\n  beakTop?: string;\r\n\r\n  /**\r\n   * The right position of the beak\r\n   */\r\n  beakRight?: string;\r\n\r\n  /**\r\n   * The bottom position of the beak\r\n   */\r\n  beakBottom?: string;\r\n\r\n  /**\r\n   * Alignment edge of callout in relation to target\r\n   */\r\n  targetAlignment?: RectangleEdge;\r\n\r\n  /**\r\n   * Position of Coachmark/TeachingBubble in relation to target\r\n   */\r\n  targetPosition?: RectangleEdge;\r\n\r\n  /**\r\n   * Transform origin of teaching bubble callout\r\n   */\r\n  transformOrigin?: string;\r\n\r\n  /**\r\n   * ARIA alert text to read aloud with Narrator once the Coachmark is mounted\r\n   */\r\n  alertText?: string;\r\n}\r\n\r\nexport class Coachmark extends BaseComponent<ICoachmarkTypes, ICoachmarkState> {\r\n  public static defaultProps: Partial<ICoachmarkTypes> = {\r\n    isCollapsed: true,\r\n    mouseProximityOffset: 10,\r\n    delayBeforeMouseOpen: 3600, // The approximate time the coachmark shows up\r\n    color: DefaultPalette.themePrimary,\r\n    isPositionForced: true,\r\n    positioningContainerProps: {\r\n      directionalHint: DirectionalHint.bottomAutoEdge,\r\n    }\r\n  };\r\n\r\n  /**\r\n   * The cached HTMLElement reference to the Entity Inner Host\r\n   * element.\r\n   */\r\n  private _entityInnerHostElement = createRef<HTMLDivElement>();\r\n  private _translateAnimationContainer = createRef<HTMLDivElement>();\r\n  private _ariaAlertContainer = createRef<HTMLDivElement>();\r\n  private _positioningContainer = createRef<IPositioningContainer>();\r\n\r\n  /**\r\n   * The target element the mouse would be in\r\n   * proximity to\r\n   */\r\n  private _targetElementRect: ClientRect;\r\n\r\n  constructor(props: ICoachmarkTypes) {\r\n    super(props);\r\n\r\n    // Set defaults for state\r\n    this.state = {\r\n      isCollapsed: props.isCollapsed!,\r\n      isBeaconAnimating: true,\r\n      isMeasuring: true,\r\n      entityInnerHostRect: {\r\n        width: 0,\r\n        height: 0\r\n      },\r\n      isMouseInProximity: false\r\n    };\r\n  }\r\n\r\n  private get _beakDirection(): RectangleEdge {\r\n    const { targetPosition } = this.state;\r\n    if (targetPosition === undefined) {\r\n      return RectangleEdge.bottom;\r\n    }\r\n\r\n    return getOppositeEdge(targetPosition);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const {\r\n      children,\r\n      target,\r\n      color,\r\n      positioningContainerProps,\r\n      ariaDescribedBy,\r\n      ariaDescribedByText,\r\n      ariaLabelledBy,\r\n      ariaLabelledByText,\r\n      ariaAlertText\r\n    } = this.props;\r\n\r\n    const {\r\n      beakLeft,\r\n      beakTop,\r\n      beakRight,\r\n      beakBottom,\r\n      isCollapsed,\r\n      isBeaconAnimating,\r\n      isMeasuring,\r\n      entityInnerHostRect,\r\n      transformOrigin,\r\n      alertText\r\n    } = this.state;\r\n\r\n    const classNames = getClassNames(getStyles, {\r\n      isCollapsed: isCollapsed,\r\n      isBeaconAnimating: isBeaconAnimating,\r\n      isMeasuring: isMeasuring,\r\n      entityHostHeight: `${entityInnerHostRect.height}px`,\r\n      entityHostWidth: `${entityInnerHostRect.width}px`,\r\n      width: `${COACHMARK_WIDTH}px`,\r\n      height: `${COACHMARK_HEIGHT}px`,\r\n      color: color,\r\n      transformOrigin: transformOrigin\r\n    });\r\n\r\n    const finalHeight: number = isCollapsed ? COACHMARK_HEIGHT : entityInnerHostRect.height;\r\n\r\n    return (\r\n      <PositioningContainer\r\n        target={ target }\r\n        offsetFromTarget={ BEAK_HEIGHT }\r\n        componentRef={ this._positioningContainer }\r\n        finalHeight={ finalHeight }\r\n        onPositioned={ this._onPositioned }\r\n        bounds={ this._getBounds() }\r\n        { ...positioningContainerProps }\r\n      >\r\n        <div className={ classNames.root }>\r\n          { ariaAlertText && (\r\n            <div\r\n              className={ classNames.ariaContainer }\r\n              role='alert'\r\n              ref={ this._ariaAlertContainer }\r\n              aria-hidden={ !isCollapsed }\r\n            >\r\n              { alertText }\r\n            </div>\r\n          ) }\r\n          <div className={ classNames.pulsingBeacon } />\r\n          <div\r\n            className={ classNames.translateAnimationContainer }\r\n            ref={ this._translateAnimationContainer }\r\n          >\r\n            <div className={ classNames.scaleAnimationLayer }>\r\n              <div className={ classNames.rotateAnimationLayer }>\r\n                {\r\n                  this._positioningContainer.current && <Beak\r\n                    left={ beakLeft }\r\n                    top={ beakTop }\r\n                    right={ beakRight }\r\n                    bottom={ beakBottom }\r\n                    direction={ this._beakDirection }\r\n                    color={ color }\r\n                  />\r\n                }\r\n                <FocusTrapZone isClickableOutsideFocusTrap={ true }>\r\n                  <div\r\n                    className={ classNames.entityHost }\r\n                    tabIndex={ -1 }\r\n                    data-is-focusable={ true }\r\n                    role='dialog'\r\n                    aria-labelledby={ ariaLabelledBy }\r\n                    aria-describedby={ ariaDescribedBy }\r\n                  >\r\n                    { isCollapsed && [\r\n                      ariaLabelledBy && (\r\n                        <p id={ ariaLabelledBy } className={ classNames.ariaContainer }>\r\n                          { ariaLabelledByText }\r\n                        </p>\r\n                      ),\r\n                      ariaDescribedBy && (\r\n                        <p id={ ariaDescribedBy } className={ classNames.ariaContainer }>\r\n                          { ariaDescribedByText }\r\n                        </p>\r\n                      )\r\n                    ] }\r\n                    <div\r\n                      className={ classNames.entityInnerHost }\r\n                      ref={ this._entityInnerHostElement }\r\n                      aria-hidden={ isCollapsed }\r\n                    >\r\n                      { children }\r\n                    </div>\r\n                  </div>\r\n                </FocusTrapZone>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </PositioningContainer>\r\n    );\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: ICoachmarkTypes): void {\r\n    if (this.props.isCollapsed && !newProps.isCollapsed) {\r\n      // The coachmark is about to open\r\n      this._openCoachmark();\r\n    }\r\n  }\r\n\r\n  public shouldComponentUpdate(newProps: ICoachmarkTypes, newState: ICoachmarkState): boolean {\r\n    return !shallowCompare(newProps, this.props) || !shallowCompare(newState, this.state);\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: ICoachmarkTypes, prevState: ICoachmarkState): void {\r\n    if (prevState.targetAlignment !== this.state.targetAlignment || prevState.targetPosition !== this.state.targetPosition) {\r\n      this._setBeakPosition();\r\n    }\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this._async.requestAnimationFrame(\r\n      (): void => {\r\n        if (\r\n          this._entityInnerHostElement.current &&\r\n          this.state.entityInnerHostRect.width + this.state.entityInnerHostRect.width === 0\r\n        ) {\r\n          this.setState({\r\n            isMeasuring: false,\r\n            entityInnerHostRect: {\r\n              width: this._entityInnerHostElement.current.offsetWidth,\r\n              height: this._entityInnerHostElement.current.offsetHeight\r\n            }\r\n          });\r\n          this._setBeakPosition();\r\n          this.forceUpdate();\r\n        }\r\n\r\n        this._events.on(document, 'keydown', this._onKeyDown, true);\r\n\r\n        // We dont want to the user to immediatley trigger the coachmark when it's opened\r\n        this._async.setTimeout(() => {\r\n          this._addProximityHandler(this.props.mouseProximityOffset);\r\n        }, this.props.delayBeforeMouseOpen!);\r\n\r\n        // Need to add setTimeout to have narrator read change in alert container\r\n        if (this.props.ariaAlertText) {\r\n          this._async.setTimeout(() => {\r\n            if (this.props.ariaAlertText && this._ariaAlertContainer.current) {\r\n              this.setState({\r\n                alertText: this.props.ariaAlertText\r\n              });\r\n            }\r\n          }, 0);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    this._events.off(document, 'keydown', this._onKeyDown, true);\r\n  }\r\n\r\n  private _onKeyDown = (e: any): void => {\r\n    // Open coachmark if user presses ALT + C (arbitrary keypress for now)\r\n    if (\r\n      (e.altKey && e.which === KeyCodes.c) ||\r\n      (e.which === KeyCodes.enter &&\r\n        this._translateAnimationContainer.current &&\r\n        this._translateAnimationContainer.current.contains(e.target))\r\n    ) {\r\n      this._onFocusHandler();\r\n    }\r\n  }\r\n\r\n  private _onFocusHandler = (): void => {\r\n    if (this.state.isCollapsed) {\r\n      this._openCoachmark();\r\n    }\r\n  }\r\n\r\n  private _onPositioned = (positionData: IPositionedData): void => {\r\n    this._async.requestAnimationFrame(((): void => {\r\n      this.setState({\r\n        targetAlignment: positionData.alignmentEdge,\r\n        targetPosition: positionData.targetEdge\r\n      });\r\n    }));\r\n  }\r\n\r\n  private _getBounds(): IRectangle | undefined {\r\n    const { isPositionForced, positioningContainerProps } = this.props;\r\n    if (isPositionForced) {\r\n      // If directionalHint direction is the top or bottom auto edge, then we want to set the left/right bounds\r\n      // to the window x-axis to have auto positioning work correctly.\r\n      if (positioningContainerProps && (\r\n        positioningContainerProps.directionalHint === DirectionalHint.topAutoEdge ||\r\n        positioningContainerProps.directionalHint === DirectionalHint.bottomAutoEdge\r\n      )) {\r\n        return {\r\n          left: 0,\r\n          top: -Infinity,\r\n          bottom: Infinity,\r\n          right: window.innerWidth,\r\n          width: window.innerWidth,\r\n          height: Infinity\r\n        };\r\n      } else {\r\n        return {\r\n          left: -Infinity,\r\n          top: -Infinity,\r\n          bottom: Infinity,\r\n          right: Infinity,\r\n          width: Infinity,\r\n          height: Infinity\r\n        };\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private _setBeakPosition = (): void => {\r\n    let beakLeft;\r\n    let beakTop;\r\n    let beakRight;\r\n    let beakBottom;\r\n    let transformOriginX;\r\n    let transformOriginY;\r\n\r\n    const { targetAlignment } = this.state;\r\n    const distanceAdjustment = '3px';  // Adjustment distance for Beak to shift towards Coachmark bubble.\r\n\r\n    switch (this._beakDirection) {\r\n      // If Beak is pointing Up or Down\r\n      case RectangleEdge.top:\r\n      case RectangleEdge.bottom:\r\n        // If there is no target alignment, then beak is X-axis centered in callout\r\n        if (!targetAlignment) {\r\n          beakLeft = `calc(50% - ${BEAK_WIDTH / 2}px)`;\r\n          transformOriginX = 'center';\r\n        } else {\r\n          // Beak is aligned to the left of target\r\n          if (targetAlignment === RectangleEdge.left) {\r\n            beakLeft = `${COACHMARK_WIDTH / 2 - BEAK_WIDTH / 2}px`;\r\n            transformOriginX = 'left';\r\n          } else {\r\n            // Beak is aligned to the right of target\r\n            beakRight = `${COACHMARK_WIDTH / 2 - BEAK_WIDTH / 2}px`;\r\n            transformOriginX = 'right';\r\n          }\r\n        }\r\n\r\n        if (this._beakDirection === RectangleEdge.top) {\r\n          beakTop = distanceAdjustment;\r\n          transformOriginY = 'top';\r\n        } else {\r\n          beakBottom = distanceAdjustment;\r\n          transformOriginY = 'bottom';\r\n        }\r\n        break;\r\n      // If Beak is pointing Left or Right\r\n      case RectangleEdge.left:\r\n      case RectangleEdge.right:\r\n        // If there is no target alignment, then beak is Y-axis centered in callout\r\n        if (!targetAlignment) {\r\n          beakTop = `calc(50% - ${BEAK_WIDTH / 2}px)`;\r\n          transformOriginY = `center`;\r\n        } else {\r\n          // Beak is aligned to the top of target\r\n          if (targetAlignment === RectangleEdge.top) {\r\n            beakTop = `${COACHMARK_WIDTH / 2 - BEAK_WIDTH / 2}px`;\r\n            transformOriginY = `top`;\r\n          } else {\r\n            // Beak is aligned to the bottom of target\r\n            beakBottom = `${COACHMARK_WIDTH / 2 - BEAK_WIDTH / 2}px`;\r\n            transformOriginY = `bottom`;\r\n          }\r\n        }\r\n\r\n        if (this._beakDirection === RectangleEdge.left) {\r\n          beakLeft = distanceAdjustment;\r\n          transformOriginX = 'left';\r\n        } else {\r\n          beakRight = distanceAdjustment;\r\n          transformOriginX = 'right';\r\n        }\r\n        break;\r\n    }\r\n\r\n    this.setState({\r\n      beakLeft: beakLeft,\r\n      beakRight: beakRight,\r\n      beakBottom: beakBottom,\r\n      beakTop: beakTop,\r\n      transformOrigin: `${transformOriginX} ${transformOriginY}`\r\n    });\r\n  }\r\n\r\n  private _openCoachmark = (): void => {\r\n    this.setState({\r\n      isCollapsed: false\r\n    });\r\n\r\n    if (this.props.onAnimationOpenStart) {\r\n      this.props.onAnimationOpenStart();\r\n    }\r\n\r\n    this._entityInnerHostElement.current &&\r\n      this._entityInnerHostElement.current.addEventListener(\r\n        'transitionend',\r\n        (): void => {\r\n          // Need setTimeout to trigger narrator\r\n          this._async.setTimeout(() => {\r\n            if (this.props.teachingBubbleRef) {\r\n              this.props.teachingBubbleRef.focus();\r\n            }\r\n          }, 500);\r\n\r\n          if (this.props.onAnimationOpenEnd) {\r\n            this.props.onAnimationOpenEnd();\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  private _addProximityHandler(mouseProximityOffset: number = 0): void {\r\n    /**\r\n     * An array of cached ids returned when setTimeout runs during\r\n     * the window resize event trigger.\r\n     */\r\n    const timeoutIds: number[] = [];\r\n\r\n    // Take the initial measure out of the initial render to prevent\r\n    // an unnecessary render.\r\n    this._async.setTimeout(() => {\r\n      this._setTargetElementRect();\r\n\r\n      // When the window resizes we want to async\r\n      // get the bounding client rectangle.\r\n      // Every time the event is triggered we want to\r\n      // setTimeout and then clear any previous instances\r\n      // of setTimeout.\r\n      this._events.on(window, 'resize', (): void => {\r\n        timeoutIds.forEach((value: number): void => {\r\n          clearInterval(value);\r\n        });\r\n\r\n        timeoutIds.push(this._async.setTimeout((): void => {\r\n          this._setTargetElementRect();\r\n        }, 100));\r\n      });\r\n    }, 10);\r\n\r\n    // Every time the document's mouse move is triggered\r\n    // we want to check if inside of an element and\r\n    // set the state with the result.\r\n    this._events.on(document, 'mousemove', (e: MouseEvent) => {\r\n      if (this.state.isCollapsed) {\r\n        const mouseY = e.pageY;\r\n        const mouseX = e.pageX;\r\n        this._setTargetElementRect();\r\n        const isMouseInProximity = this._isInsideElement(mouseX, mouseY, mouseProximityOffset);\r\n\r\n        if (isMouseInProximity !== this.state.isMouseInProximity) {\r\n          this._openCoachmark();\r\n        }\r\n      }\r\n\r\n      if (this.props.onMouseMove) {\r\n        this.props.onMouseMove(e);\r\n      }\r\n    });\r\n  }\r\n\r\n  private _setTargetElementRect(): void {\r\n    if (this._translateAnimationContainer && this._translateAnimationContainer.current) {\r\n      this._targetElementRect = this._translateAnimationContainer!.current!.getBoundingClientRect();\r\n    }\r\n  }\r\n\r\n  private _isInsideElement(mouseX: number, mouseY: number, mouseProximityOffset: number = 0): boolean {\r\n    return mouseX > (this._targetElementRect.left - mouseProximityOffset) &&\r\n      mouseX < ((this._targetElementRect.left + this._targetElementRect.width) + mouseProximityOffset) &&\r\n      mouseY > (this._targetElementRect.top - mouseProximityOffset) &&\r\n      mouseY < ((this._targetElementRect.top + this._targetElementRect.height) + mouseProximityOffset);\r\n  }\r\n}"]}