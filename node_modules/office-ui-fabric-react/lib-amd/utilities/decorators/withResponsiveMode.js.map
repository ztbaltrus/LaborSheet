{"version":3,"file":"withResponsiveMode.js","sourceRoot":"../src/","sources":["utilities/decorators/withResponsiveMode.tsx"],"names":[],"mappings":";;;IAQA,IAAY,cAOX;IAPD,WAAY,cAAc;QACxB,qDAAS,CAAA;QACT,uDAAU,CAAA;QACV,qDAAS,CAAA;QACT,uDAAU,CAAA;QACV,yDAAW,CAAA;QACX,2DAAY,CAAA;IACd,CAAC,EAPW,cAAc,GAAd,sBAAc,KAAd,sBAAc,QAOzB;IAED,IAAM,yBAAyB,GAAG;QAChC,GAAG;QACH,GAAG;QACH,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,QAAQ;KACT,CAAC;IAEF,IAAI,YAAwC,CAAC;IAE7C;;OAEG;IACH,2BAAkC,cAA0C;QAC1E,YAAY,GAAG,cAAc,CAAC;IAChC,CAAC;IAFD,8CAEC;IAED,4BAA+F,iBAA2F;QAExL,IAAM,WAAW;YAAoC,8CAA+C;YAElG,4BAAY,KAAa;gBAAzB,YACE,kBAAM,KAAK,CAAC,SAMb;gBALC,KAAI,CAAC,2BAA2B,GAAG,KAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;gBAE/E,KAAI,CAAC,KAAK,GAAG;oBACX,cAAc,EAAE,KAAI,CAAC,kBAAkB,EAAE;iBAC1C,CAAC;;YACJ,CAAC;YAEM,8CAAiB,GAAxB;gBAAA,iBAUC;gBATC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE;oBAChC,IAAM,cAAc,GAAG,KAAI,CAAC,kBAAkB,EAAE,CAAC;oBAEjD,IAAI,cAAc,KAAK,KAAI,CAAC,KAAK,CAAC,cAAc,EAAE;wBAChD,KAAI,CAAC,QAAQ,CAAC;4BACZ,cAAc,EAAE,cAAc;yBAC/B,CAAC,CAAC;qBACJ;gBACH,CAAC,CAAC,CAAC;YACL,CAAC;YAEM,iDAAoB,GAA3B;gBACE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YACzB,CAAC;YAEM,mCAAM,GAAb;gBACU,IAAA,0CAAc,CAAgB;gBAEtC,OAAO,CACL,oBAAC,iBAAiB,qBAAC,GAAG,EAAG,IAAI,CAAC,2BAA2B,EAAG,cAAc,EAAG,cAAc,IAAQ,IAAI,CAAC,KAAY,EAAK,CAC1H,CAAC;YACJ,CAAC;YAEO,+CAAkB,GAA1B;gBACE,IAAI,cAAc,GAAG,cAAc,CAAC,KAAK,CAAC;gBAC1C,IAAM,GAAG,GAAG,qBAAS,EAAE,CAAC;gBAExB,IAAI,OAAO,GAAG,KAAK,WAAW,EAAE;oBAC9B,IAAI;wBACF,OAAO,GAAG,CAAC,UAAU,GAAG,yBAAyB,CAAC,cAAc,CAAC,EAAE;4BACjE,cAAc,EAAE,CAAC;yBAClB;qBACF;oBAAC,OAAO,CAAC,EAAE;wBACV,uGAAuG;wBACvG,cAAc,GAAG,cAAc,CAAC,KAAK,CAAC;qBACvC;iBACF;qBAAM;oBACL,IAAI,YAAY,KAAK,SAAS,EAAE;wBAC9B,cAAc,GAAG,YAAY,CAAC;qBAC/B;yBAAM;wBACL,MAAM,IAAI,KAAK,CACb,4FAA4F;4BAC5F,+DAA+D,CAChE,CAAC;qBACH;iBACF;gBAED,OAAO,cAAc,CAAC;YACxB,CAAC;YAEH,yBAAC;QAAD,CAAC,AA9DmB,CAAiC,6BAAa,EA8DjE,CAAC;QACF,OAAO,wBAAY,CAAC,iBAAiB,EAAE,WAAW,CAAC,CAAC;IACtD,CAAC;IAlED,gDAkEC","sourcesContent":["import * as React from 'react';\r\nimport { BaseDecorator } from './BaseDecorator';\r\nimport { getWindow, hoistStatics } from '../../Utilities';\r\n\r\nexport interface IWithResponsiveModeState {\r\n  responsiveMode?: ResponsiveMode;\r\n}\r\n\r\nexport enum ResponsiveMode {\r\n  small = 0,\r\n  medium = 1,\r\n  large = 2,\r\n  xLarge = 3,\r\n  xxLarge = 4,\r\n  xxxLarge = 5\r\n}\r\n\r\nconst RESPONSIVE_MAX_CONSTRAINT = [\r\n  479,\r\n  639,\r\n  1023,\r\n  1365,\r\n  1919,\r\n  99999999\r\n];\r\n\r\nlet _defaultMode: ResponsiveMode | undefined;\r\n\r\n/**\r\n * Allows a server rendered scenario to provide a default responsive mode.\r\n */\r\nexport function setResponsiveMode(responsiveMode: ResponsiveMode | undefined): void {\r\n  _defaultMode = responsiveMode;\r\n}\r\n\r\nexport function withResponsiveMode<TProps extends { responsiveMode?: ResponsiveMode }, TState>(ComposedComponent: (new (props: TProps, ...args: any[]) => React.Component<TProps, TState>)): any {\r\n\r\n  const resultClass = class WithResponsiveMode extends BaseDecorator<TProps, IWithResponsiveModeState> {\r\n\r\n    constructor(props: TProps) {\r\n      super(props);\r\n      this._updateComposedComponentRef = this._updateComposedComponentRef.bind(this);\r\n\r\n      this.state = {\r\n        responsiveMode: this._getResponsiveMode()\r\n      };\r\n    }\r\n\r\n    public componentDidMount(): void {\r\n      this._events.on(window, 'resize', () => {\r\n        const responsiveMode = this._getResponsiveMode();\r\n\r\n        if (responsiveMode !== this.state.responsiveMode) {\r\n          this.setState({\r\n            responsiveMode: responsiveMode\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    public componentWillUnmount(): void {\r\n      this._events.dispose();\r\n    }\r\n\r\n    public render(): JSX.Element {\r\n      const { responsiveMode } = this.state;\r\n\r\n      return (\r\n        <ComposedComponent ref={ this._updateComposedComponentRef } responsiveMode={ responsiveMode } { ...this.props as any } />\r\n      );\r\n    }\r\n\r\n    private _getResponsiveMode(): ResponsiveMode {\r\n      let responsiveMode = ResponsiveMode.small;\r\n      const win = getWindow();\r\n\r\n      if (typeof win !== 'undefined') {\r\n        try {\r\n          while (win.innerWidth > RESPONSIVE_MAX_CONSTRAINT[responsiveMode]) {\r\n            responsiveMode++;\r\n          }\r\n        } catch (e) {\r\n          // Return a best effort result in cases where we're in the browser but it throws on getting innerWidth.\r\n          responsiveMode = ResponsiveMode.large;\r\n        }\r\n      } else {\r\n        if (_defaultMode !== undefined) {\r\n          responsiveMode = _defaultMode;\r\n        } else {\r\n          throw new Error(\r\n            'Content was rendered in a server environment without providing a default responsive mode. ' +\r\n            'Call setResponsiveMode to define what the responsive mode is.'\r\n          );\r\n        }\r\n      }\r\n\r\n      return responsiveMode;\r\n    }\r\n\r\n  };\r\n  return hoistStatics(ComposedComponent, resultClass);\r\n}\r\n"]}