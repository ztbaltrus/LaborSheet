{"version":3,"sources":["cli/logic/test/Telemetry.test.ts"],"names":[],"mappings":"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","file":"Telemetry.test.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as path from 'path';\r\n\r\nimport { RushConfiguration } from '../../../data/RushConfiguration';\r\nimport { Rush } from '../../../Rush';\r\nimport {\r\n  Telemetry,\r\n  ITelemetryData\r\n } from '../Telemetry';\r\n\r\ndescribe('Telemetry', () => {\r\n  it('adds data to store if telemetry is enabled', () => {\r\n    const filename: string = path.resolve(path.join(__dirname, './telemetry/telemetryEnabled.json'));\r\n    const rushConfig: RushConfiguration = RushConfiguration.loadFromConfigurationFile(filename);\r\n    const telemetry: Telemetry = new Telemetry(rushConfig);\r\n    const logData1: ITelemetryData = {\r\n      name: 'testData1',\r\n      duration: 100,\r\n      result: 'Succeeded',\r\n      timestamp: new Date().getTime(),\r\n      platform: process.platform,\r\n      rushVersion: Rush.version\r\n    };\r\n\r\n    const logData2: ITelemetryData = {\r\n      name: 'testData2',\r\n      duration: 100,\r\n      result: 'Failed',\r\n      timestamp: new Date().getTime(),\r\n      platform: process.platform,\r\n      rushVersion: Rush.version\r\n    };\r\n\r\n    telemetry.log(logData1);\r\n    telemetry.log(logData2);\r\n    expect(telemetry.store).toEqual([logData1, logData2]);\r\n  });\r\n\r\n  it('does not add data to store if telemetry is not enabled', () => {\r\n    const filename: string = path.resolve(path.join(__dirname, './telemetry/telemetryNotEnabled.json'));\r\n    const rushConfig: RushConfiguration = RushConfiguration.loadFromConfigurationFile(filename);\r\n    const telemetry: Telemetry = new Telemetry(rushConfig);\r\n    const logData: ITelemetryData = {\r\n      name: 'testData',\r\n      duration: 100,\r\n      result: 'Succeeded',\r\n      timestamp: new Date().getTime(),\r\n      platform: process.platform,\r\n      rushVersion: Rush.version\r\n    };\r\n\r\n    telemetry.log(logData);\r\n    expect(telemetry.store).toEqual([]);\r\n  });\r\n\r\n  it('deletes data after flush', () => {\r\n    const filename: string = path.resolve(path.join(__dirname, './telemetry/telemetryEnabled.json'));\r\n    const rushConfig: RushConfiguration = RushConfiguration.loadFromConfigurationFile(filename);\r\n    const telemetry: Telemetry = new Telemetry(rushConfig);\r\n    const logData: ITelemetryData = {\r\n      name: 'testData1',\r\n      duration: 100,\r\n      result: 'Succeeded',\r\n      timestamp: new Date().getTime(),\r\n      platform: process.platform,\r\n      rushVersion: Rush.version\r\n    };\r\n\r\n    telemetry.log(logData);\r\n    let logFile: string;\r\n    let dataToWrite: string;\r\n    telemetry.flush((file, data) => {\r\n      logFile = file;\r\n      dataToWrite = data;\r\n    });\r\n    expect(logFile!.match(/telemetry_.*\\.json/)).toBeDefined();\r\n    expect(dataToWrite!).toEqual(JSON.stringify([logData]));\r\n    expect(telemetry.store).toEqual([]);\r\n  });\r\n\r\n  it('populates default fields', () => {\r\n    const filename: string = path.resolve(path.join(__dirname, './telemetry/telemetryEnabled.json'));\r\n    const rushConfig: RushConfiguration = RushConfiguration.loadFromConfigurationFile(filename);\r\n    const telemetry: Telemetry = new Telemetry(rushConfig);\r\n    const logData: ITelemetryData = {\r\n      name: 'testData1',\r\n      duration: 100,\r\n      result: 'Succeeded'\r\n    };\r\n\r\n    telemetry.log(logData);\r\n    const result: ITelemetryData = telemetry.store[0];\r\n    expect(result.platform).toEqual(process.platform);\r\n    expect(result.rushVersion).toEqual(Rush.version);\r\n    expect(result.timestamp).toBeDefined();\r\n  });\r\n});"],"sourceRoot":"../../../../../../../src"}