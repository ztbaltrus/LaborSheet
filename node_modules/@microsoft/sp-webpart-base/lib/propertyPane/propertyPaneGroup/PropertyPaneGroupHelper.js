import { Validate } from '@microsoft/sp-core-library';
import * as lodash from '@microsoft/sp-lodash-subset';
import { PropertyPaneFieldType } from '../propertyPaneFields/propertyPaneField/IPropertyPaneField';
import { DynamicProperty } from '@microsoft/sp-component-base';
export function generateGroupFieldKey(keys, groupField) {
    var key = '';
    if (groupField.type === PropertyPaneFieldType.Custom) {
        Validate.isNonemptyString(groupField.properties.key, 'Custom field key');
        var customField = groupField;
        key = customField.type + "-" + customField.properties.key;
    }
    else {
        key = groupField.type + "-" + (groupField.targetProperty || '');
    }
    var keyIndex = keys[key] || 0;
    keys[key] = keyIndex + 1;
    key += "-" + keyIndex;
    return key;
}
export function getFixedUpPropValue(field, properties, dynamicConfiguration) {
    var fixedUpPropValue = lodash.get(properties, field.targetProperty);
    if (field.type === PropertyPaneFieldType.DynamicFieldSet) {
        var entries_1 = [];
        field.properties.entries.forEach(function (entry) {
            var propValue = lodash.get(properties, entry.targetProperty); 
            var callback = field.properties.callback;
            entries_1.push({
                targetProperty: entry.targetProperty,
                value: getFixedUpDynamicProperty(dynamicConfiguration, propValue, callback),
                label: entry.label
            });
        });
        fixedUpPropValue = entries_1;
    }
    else if (field.type === PropertyPaneFieldType.DynamicField) {
        var callback = field.properties.callback;
        var entry = {
            targetProperty: field.targetProperty,
            value: getFixedUpDynamicProperty(dynamicConfiguration, fixedUpPropValue, callback),
            label: field.properties.label
        };
        fixedUpPropValue = entry;
    }
    else {
        if (fixedUpPropValue instanceof DynamicProperty) {
            fixedUpPropValue = fixedUpPropValue.tryGetValue(); 
        }
    }
    return fixedUpPropValue;
}
export function getFixedUpDynamicProperty(dynamicConfiguration, propValue, 
    callback) {
    var isDynamicProperty = (propValue instanceof DynamicProperty);
    if (!isDynamicProperty) {
        var defaultCallback = callback || dynamicConfiguration.defaultCallback;
        var tempPropValue = propValue; 
        propValue = new DynamicProperty(dynamicConfiguration.dynamicDataProvider, defaultCallback);
        propValue.setValue(tempPropValue); 
    }
    return propValue;
}
