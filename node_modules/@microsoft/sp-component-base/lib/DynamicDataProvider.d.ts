import { IDisposable, ServiceScope } from '@microsoft/sp-core-library';
import { DynamicDataReference, IDynamicDataSource } from '@microsoft/sp-dynamic-data';
import BaseComponent from './BaseComponent';
/**
 * The Dynamic Data Provider allows components to consume Dynamic Data.
 * It allows components to request Dynamic Data sources and register/unregister to those.
 *
 * @beta
 */
export default class DynamicDataProvider implements IDisposable {
    private _dynamicDataManager;
    private _component;
    private _isDisposed;
    private _isInitialized;
    private _isSourcesChangedEventListenerAdded;
    /**
     * Set of pending registrations.
     */
    private _pendingRegistrations;
    /**
     * Returns true if the Dynamic Data feature is enabled.
     *
     * @internal
     */
    static _isDynamicDataEnabled(): boolean;
    /**
     * Initializes the Dynamic Data Provider for a specific component.
     *
     * @param component - Component that is going to use the Dynamic Data Provider.
     *
     * @internal
     */
    _initialize(component: BaseComponent, serviceScope: ServiceScope): void;
    /**
     * Disposes the Dynamic Data Provider.
     */
    dispose(): void;
    /**
     * Returns true if the Dynamic Data Provider is disposed.
     */
    readonly isDisposed: boolean;
    /**
     * Registers a callback for updates when a Dynamic Data source is changed.
     * This happens when any property is updated within the source.
     *
     * @internalremarks
     * We register the source, only if the source is available else defer the registration
     * to when the availableSources change.
     *
     * @param sourceId - Id of the Dynamic Data Source.
     * @param callback - Function to execute when the source updates its data.
     */
    registerSourceChanged(sourceId: string, callback: () => void): void;
    /**
     * Unregisters a callback for updates when a Dynamic Data source is changed.
     *
     * @internalremarks
     * If the sourceId is present in _registeredSourcesForSourceChanged then
     *    it removes from sourceID from the set _registeredSourcesForSourceChanged and
     *    invokes unregisterSourceChanged event on the DynamicDataManager
     *
     * else if the sourceId is present in _pendingSourcesForSourceChanged then
     *    it just removes the sourceId from the set _pendingSourcesForSourceChanged
     *
     * else, it is a no-op
     *
     * @param sourceId - Id of the Dynamic Data Source.
     * @param callback - Function to remove from the registration. Must be the same it was registered with.
     */
    unregisterSourceChanged(sourceId: string, callback: () => void): void;
    /**
     * Registers a callback for updates when a property is changed in a Dynamic Data source.
     *
     * @internalremarks
     * We register the source, only if the source is available else defer the registration
     * to when the availableSources change.
     *
     * @param sourceId - Id of the Dynamic Data Source.
     * @param propertyId - Id of the property of the source.
     * @param callback - Function to execute when the source updates its data.
     */
    registerPropertyChanged(sourceId: string, propertyId: string, callback: () => void): void;
    /**
     * Unregisters a callback for updates when a property is changed in a Dynamic Data source.
     *
     * @internalremarks
     * If the sourceId is present in _registeredSourcesForPropertyChanged then
     *    it removes from sourceID from the set _registeredSourcesForPropertyChanged and
     *    invokes unregisterPropertyChanged event on the DynamicDataManager
     *
     * else if the sourceId is present in _pendingSourcesForPropertyChanged then
     *    it just removes the sourceId from the set _pendingSourcesForPropertyChanged
     *
     * @param sourceId - Id of the Dynamic Data Source.
     * @param propertyId - Id of the property of the source.
     * @param callback - Function to remove from the registration. Must be the same it was registered with.
     */
    unregisterPropertyChanged(sourceId: string, propertyId: string, callback: () => void): void;
    /**
     * Registers a callback to an event that raises when the list of available Dynamic Data Sources is updated.
     *
     * @param callback - Function to execute when the sources are updated.
     */
    registerAvailableSourcesChanged(callback: () => void): void;
    /**
     * Unregisters a callback to an event that raises when the list of available Dynamic Data Sources is updated.
     *
     * @internalremarks
     * This api is used by the consumer of the dynamic data.
     *
     * @param callback - Function to remove from the registration. Must be the same it was registered with.
     */
    unregisterAvailableSourcesChanged(callback: () => void): void;
    /**
     * Returns a list with all available Dynamic Data Sources.
     *
     * @returns Read-only array with all available sources.
     */
    getAvailableSources(): ReadonlyArray<IDynamicDataSource>;
    /**
     * Returns a Dynamic Data Source, by its id.
     * If the source is not present, it returns undefined.
     *
     * @param id - Id of the Dynamic Data Source.
     */
    tryGetSource(id: string): IDynamicDataSource | undefined;
    /**
     * Returns specific data from a source based on a Dynamic Data reference.
     *
     * @param dataReference - Dynamic Data Reference.
     * @internal
     */
    _getData<TData>(dataReference: DynamicDataReference): TData | undefined;
    /**
     * When the available sources change, following things happen:
     *  1. Update _pendingSourcesForSourceChanged
     *    - Check if any of the sources from the _pendingSourcesForSourceChanged is in the avaialbe sources
     *    - If yes, then register to the 'registerSourceChanged' event on that source
     *    - then add that source to list of '_registeredSourcesForSourceChanged' and
     *    - delete it from the _pendingSourcesForSourceChanged list
     *
     *  2. Update _pendingSourcesForPropertyChanged
     *    - Check if any of the sources from the _pendingSourcesForPropertyChanged are in the avaialbe sources
     *    - If yes, then register to the 'registerPropertyChanged' event on that source
     *    - then add that source to list of '_registeredSourcesForPropertyChanged' and
     *    - then delete it from the _pendingSourcesForPropertyChanged list
     */
    private _onSourcesChanged();
    private _assertNotDisposed();
    private _assertInitialized();
    /**
     * Adds the registration to the pending registrations if not already added.
     * Also adds a listener to the _DynamicDataManager's sourcesChangedEvent.
     */
    private _addPendingRegistration(registration);
    /**
     * Removes the pending registration and then, if there are no more pending registrations
     * remove the 'sourcesChangedEvent' listener.
     */
    private _removePendingRegistration(registration);
    /**
     * Returns true if the incoming source is already added to the _pendingRegistrations set.
     *
     * @param incomingRegistration - registration to be checked.
     */
    private isRegistrationPending(incomingRegistration);
}
